vars:
  PROJECT_NAME: nabi-auth
  SQLC_VERSION: latest
  MOCKGEN_PACKAGE: go.uber.org/mock/mockgen

---
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –∏–∑ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
sqlc-generate:
  doc: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Go –∫–æ–¥ –∏–∑ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—è sqlc
  script:
    - echo "Generating code from SQL queries..."
    - sqlc generate
    - echo "‚úÖ SQL code generation completed"

---
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
mocks-generate:
  doc: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Å go:generate –¥–∏—Ä–µ–∫—Ç–∏–≤–∞–º–∏
  script:
    - echo "Generating mocks..."
    - go generate ./...
    - echo "‚úÖ Mocks generation completed"

---
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
migration-new:
  doc: –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  script:
    - |
      if [ -z "{{.Vars.migration_name}}" ]; then
        echo "‚ùå Error: migration_name is required"
        echo "Usage: gomake run migration-new --var migration_name=create_users_table"
        exit 1
      fi
    - echo "Creating new migration: {{.Vars.migration_name}}"
    - dbmate new {{.Vars.migration_name}}
    - echo "‚úÖ Migration created successfully"

---
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
migration-up:
  doc: –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ pending –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  script:
    - echo "Applying database migrations..."
    - dbmate up
    - echo "‚úÖ Migrations applied successfully"

---
# –û—Ç–∫–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
migration-down:
  doc: –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
  script:
    - echo "Rolling back last migration..."
    - dbmate down
    - echo "‚úÖ Migration rolled back successfully"

---
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
go-test:
  doc: –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
  script:
    - echo "Running tests..."
    - go test ./... -v
    - echo "‚úÖ Tests completed"

---
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
go-test-coverage:
  doc: –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
  script:
    - echo "Running tests with coverage..."
    - go test ./... -coverprofile=coverage.out
    - go tool cover -html=coverage.out -o coverage.html
    - echo "‚úÖ Coverage report generated: coverage.html"

---
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go-mod-download:
  doc: –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
  script:
    - echo "Downloading dependencies..."
    - go mod download
    - echo "‚úÖ Dependencies downloaded"

---
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go-mod-tidy:
  doc: –û—á–∏—â–∞–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç go.mod –∏ go.sum
  script:
    - echo "Tidying go modules..."
    - go mod tidy
    - echo "‚úÖ Go modules tidied"

---
# –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go-mod-verify:
  doc: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  script:
    - echo "Verifying dependencies..."
    - go mod verify
    - echo "‚úÖ Dependencies verified"

---
# –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
go-build:
  doc: –°–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  script:
    - echo "Building application..."
    - go build -o bin/{{.Vars.PROJECT_NAME}} ./main.go
    - echo "‚úÖ Build completed: bin/{{.Vars.PROJECT_NAME}}"

---
# –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
setup:
  doc: –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
  stage: setup
  script:
    - echo "üöÄ Setting up project..."
    - go mod download
    - sqlc generate
    - go generate ./...
    - echo "‚úÖ Project setup completed"

---
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
migrate-and-generate:
  doc: –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ (sqlc + mocks)
  stage: generate
  script:
    - echo "üîÑ Applying migrations and regenerating code..."
    - dbmate up
    - sqlc generate
    - go generate ./...
    - echo "‚úÖ Migrations applied and code regenerated"

---
# –û—á–∏—Å—Ç–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
clean:
  doc: –û—á–∏—â–∞–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏
  script:
    - echo "Cleaning generated files..."
    - rm -rf bin/
    - rm -rf tmp/
    - rm -f coverage.out coverage.html
    - echo "‚úÖ Clean completed"

---
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
go-fmt:
  doc: –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –≤–µ—Å—å Go –∫–æ–¥
  script:
    - echo "Formatting code..."
    - go fmt ./...
    - echo "‚úÖ Code formatted"

---
# –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞
go-vet:
  doc: –ó–∞–ø—É—Å–∫–∞–µ—Ç go vet –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞
  script:
    - echo "Running go vet..."
    - go vet ./...
    - echo "‚úÖ Go vet completed"

---
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ (fmt + vet + test)
go-check:
  doc: –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä–∫—É –∏ —Ç–µ—Å—Ç—ã
  stage: check
  script:
    - echo "üîç Running code checks..."
    - go fmt ./...
    - go vet ./...
    - go test ./... -v
    - echo "‚úÖ Code checks completed"

---
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
help:
  doc: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º
  script:
    - echo "Available commands:"
    - echo ""
    - echo "Code Generation:"
    - echo "  sqlc-generate       - Generate Go code from SQL queries"
    - echo "  mocks-generate      - Generate mocks for interfaces"
    - echo ""
    - echo "Database:"
    - echo "  migration-new      - Create new migration (requires --var migration_name=name)"
    - echo "  migration-up       - Apply pending migrations"
    - echo "  migration-down     - Rollback last migration"
    - echo ""
    - echo "Testing:"
    - echo "  go-test            - Run all tests"
    - echo "  go-test-coverage   - Run tests with coverage report"
    - echo ""
    - echo "Build:"
    - echo "  go-build           - Build application"
    - echo "  go-mod-download    - Download dependencies"
    - echo "  go-mod-tidy        - Tidy go modules"
    - echo ""
    - echo "Utilities:"
    - echo "  setup              - Full project setup"
    - echo "  migrate-and-generate - Apply migrations and regenerate code"
    - echo "  clean              - Clean generated files"
    - echo "  go-fmt             - Format code"
    - echo "  go-vet             - Run go vet"
    - echo "  go-check           - Run fmt + vet + test"
    - echo ""
    - echo "For more details, use: gomake run <command> --help"

